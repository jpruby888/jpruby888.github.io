<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>前后端分离项目笔记 | jpruby的blog</title><meta name="keywords" content="java,vue"><meta name="author" content="jpruby"><meta name="copyright" content="jpruby"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="前后端分离项目文章总体分为2大部分，Java后端接口和vue前端页面，比较长，因为不想分开发布，真正想你4小时学会，哈哈。 先看效果：   不多说，开始敲代码。 Java后端接口开发1、前言从零开始搭建一个项目骨架，最好选择合适，熟悉的技术，并且在未来易拓展，适合微服务化体系等。所以一般以Springboot作为我们的框架基础，这是离不开的了。 然后数据层，我们常用的是Mybatis，易上手，方便">
<meta property="og:type" content="article">
<meta property="og:title" content="前后端分离项目笔记">
<meta property="og:url" content="https://jpruby888.github.io/post/3eb4351b.html">
<meta property="og:site_name" content="jpruby的blog">
<meta property="og:description" content="前后端分离项目文章总体分为2大部分，Java后端接口和vue前端页面，比较长，因为不想分开发布，真正想你4小时学会，哈哈。 先看效果：   不多说，开始敲代码。 Java后端接口开发1、前言从零开始搭建一个项目骨架，最好选择合适，熟悉的技术，并且在未来易拓展，适合微服务化体系等。所以一般以Springboot作为我们的框架基础，这是离不开的了。 然后数据层，我们常用的是Mybatis，易上手，方便">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://jpruby888.github.io/images/featureimages/13.jpg">
<meta property="article:published_time" content="2022-03-20T14:24:12.000Z">
<meta property="article:modified_time" content="2022-03-21T03:28:57.819Z">
<meta property="article:author" content="jpruby">
<meta property="article:tag" content="java">
<meta property="article:tag" content="vue">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://jpruby888.github.io/images/featureimages/13.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://jpruby888.github.io/post/3eb4351b"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '前后端分离项目笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-03-21 11:28:57'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.1.0"><link rel="alternate" href="/atom.xml" title="jpruby的blog" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/images/favicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">248</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">222</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">33</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/images/featureimages/13.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">jpruby的blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fas fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">前后端分离项目笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2022-03-20T14:24:12.000Z" title="发表于 2022-03-20 22:24:12">2022-03-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-03-21T03:28:57.819Z" title="更新于 2022-03-21 11:28:57">2022-03-21</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="前后端分离项目笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="前后端分离项目"><a href="#前后端分离项目" class="headerlink" title="前后端分离项目"></a>前后端分离项目</h2><p>文章总体分为2大部分，Java后端接口和vue前端页面，比较长，因为不想分开发布，真正想你4小时学会，哈哈。</p>
<p>先看效果：</p>
<p><img src="https://image-1300566513.cos.ap-guangzhou.myqcloud.com/upload/images/20201117/6e25b3a7df92467ea08888f72d28a205.png" alt="图片"></p>
<p><img src="https://image-1300566513.cos.ap-guangzhou.myqcloud.com/upload/images/20201117/354dd5cafdb94e94a9f3553eef95e0b2.png" alt="图片"></p>
<p>不多说，开始敲代码。</p>
<h2 id="Java后端接口开发"><a href="#Java后端接口开发" class="headerlink" title="Java后端接口开发"></a>Java后端接口开发</h2><h3 id="1、前言"><a href="#1、前言" class="headerlink" title="1、前言"></a>1、前言</h3><p>从零开始搭建一个项目骨架，最好选择合适，熟悉的技术，并且在未来易拓展，适合微服务化体系等。所以一般以Springboot作为我们的框架基础，这是离不开的了。</p>
<p>然后数据层，我们常用的是Mybatis，易上手，方便维护。但是单表操作比较困难，特别是添加字段或减少字段的时候，比较繁琐，所以这里我推荐使用Mybatis Plus（<a target="_blank" rel="noopener" href="https://mp.baomidou.com/%EF%BC%89%EF%BC%8C%E4%B8%BA%E7%AE%80%E5%8C%96%E5%BC%80%E5%8F%91%E8%80%8C%E7%94%9F%EF%BC%8C%E5%8F%AA%E9%9C%80%E7%AE%80%E5%8D%95%E9%85%8D%E7%BD%AE%EF%BC%8C%E5%8D%B3%E5%8F%AF%E5%BF%AB%E9%80%9F%E8%BF%9B%E8%A1%8C">https://mp.baomidou.com/），为简化开发而生，只需简单配置，即可快速进行</a> CRUD 操作，从而节省大量时间。</p>
<p>作为一个项目骨架，权限也是我们不能忽略的，Shiro配置简单，使用也简单，所以使用Shiro作为我们的的权限。</p>
<p>考虑到项目可能需要部署多台，这时候我们的会话等信息需要共享，Redis是现在主流的缓存中间件，也适合我们的项目。</p>
<p>然后因为前后端分离，所以我们使用jwt作为我们用户身份凭证。</p>
<p>ok，我们现在就开始搭建我们的项目脚手架！</p>
<p>技术栈：</p>
<ul>
<li>SpringBoot</li>
<li>mybatis plus</li>
<li>shiro</li>
<li>lombok</li>
<li>redis</li>
<li>hibernate validatior</li>
<li>jwt</li>
</ul>
<p>导图：<a target="_blank" rel="noopener" href="https://www.markerhub.com/map/131">https://www.markerhub.com/map/131</a></p>
<h3 id="2、新建Springboot项目"><a href="#2、新建Springboot项目" class="headerlink" title="2、新建Springboot项目"></a>2、新建Springboot项目</h3><p>这里，我们使用IDEA来开发我们项目，新建步骤比较简单，我们就不截图了。</p>
<p>开发工具与环境：</p>
<ul>
<li>idea</li>
<li>mysql</li>
<li>jdk 8</li>
<li>maven3.3.9</li>
</ul>
<p>新建好的项目结构如下，SpringBoot版本使用的目前最新的2.2.6.RELEASE版本</p>
<p><img src="https://image-1300566513.cos.ap-guangzhou.myqcloud.com/upload/images/20201117/be1226b48ef24b2bbe00d75996bd7f89.png" alt="图片"></p>
<p>pom的jar包导入如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;</span><br><span class="line">    &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">    &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">    &lt;optional&gt;true&lt;/optional&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>devtools：项目的热加载重启插件</p>
</li>
<li><p>lombok：简化代码的工具</p>
<h3 id="3、整合mybatis-plus"><a href="#3、整合mybatis-plus" class="headerlink" title="3、整合mybatis plus"></a>3、整合mybatis plus</h3></li>
</ul>
<p>接下来，我们来整合mybatis plus，让项目能完成基本的增删改查操作。步骤很简单：可以去官网看看：<a target="_blank" rel="noopener" href="https://mp.baomidou.com/guide/install.html">https://mp.baomidou.com/guide/install.html</a></p>
<p><strong>第一步：导入jar包</strong></p>
<p>pom中导入mybatis plus的jar包，因为后面会涉及到代码生成，所以我们还需要导入页面模板引擎，这里我们用的是freemarker。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--mp--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.baomidou&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.2.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-freemarker&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">    &lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!--mp代码生成器--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.baomidou&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mybatis-plus-generator&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.2.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p><strong>第二步：然后去写配置文件</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># DataSource Config</span><br><span class="line">spring:</span><br><span class="line">  datasource:</span><br><span class="line">    driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">    url: jdbc:mysql://localhost:3306/vueblog?useUnicode=true&amp;useSSL=false&amp;characterEncoding=utf8&amp;serverTimezone=Asia/Shanghai</span><br><span class="line">    username: root</span><br><span class="line">    password: admin</span><br><span class="line">mybatis-plus:</span><br><span class="line">  mapper-locations: classpath*:/mapper/**Mapper.xml</span><br><span class="line">server:</span><br><span class="line">  port: 8081</span><br></pre></td></tr></table></figure>

<p>上面除了配置数据库的信息，还配置了myabtis plus的mapper的xml文件的扫描路径，这一步不要忘记了。<br><strong>第三步：开启mapper接口扫描，添加分页插件</strong></p>
<p>新建一个包：通过<a target="_blank" rel="noopener" href="https://github.com/mapperScan">@mapperScan</a>注解指定要变成实现类的接口所在的包，然后包下面的所有接口在编译之后都会生成相应的实现类。PaginationInterceptor是一个分页插件。</p>
<ul>
<li>com.markerhub.config.MybatisPlusConfig</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@EnableTransactionManagement</span><br><span class="line">@MapperScan(&quot;com.markerhub.mapper&quot;)</span><br><span class="line">public class MybatisPlusConfig &#123;</span><br><span class="line">    @Bean</span><br><span class="line">    public PaginationInterceptor paginationInterceptor() &#123;</span><br><span class="line">        PaginationInterceptor paginationInterceptor = new PaginationInterceptor();</span><br><span class="line">        return paginationInterceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>第四步：代码生成</strong></p>
<p>如果你没再用其他插件，那么现在就已经可以使用mybatis plus了，官方给我们提供了一个代码生成器，然后我写上自己的参数之后，就可以直接根据数据库表信息生成entity、service、mapper等接口和实现类。</p>
<ul>
<li>com.markerhub.CodeGenerator</li>
</ul>
<p>因为代码比较长，就不贴出来了，在代码仓库上看哈！</p>
<p>首先我在数据库中新建了一个user表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `m_user` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `username` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `avatar` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `email` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `password` <span class="type">varchar</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `status` <span class="type">int</span>(<span class="number">5</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `created` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `last_login` datetime <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`),</span><br><span class="line">  KEY `UK_USERNAME` (`username`) <span class="keyword">USING</span> BTREE</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `m_blog` (</span><br><span class="line">  `id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `user_id` <span class="type">bigint</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `title` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `description` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `content` longtext,</span><br><span class="line">  `created` datetime <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  `status` tinyint(<span class="number">4</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB AUTO_INCREMENT<span class="operator">=</span><span class="number">11</span> <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> `vueblog`.`m_user` (`id`, `username`, `avatar`, `email`, `password`, `status`, `created`, `last_login`) <span class="keyword">VALUES</span> (<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;markerhub&#x27;</span>, <span class="string">&#x27;https://image-1300566513.cos.ap-guangzhou.myqcloud.com/upload/images/5a9f48118166308daba8b6da7e466aab.jpg&#x27;</span>, <span class="keyword">NULL</span>, <span class="string">&#x27;96e79218965eb72c92a549dd5a330112&#x27;</span>, <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;2020-04-20 10:44:01&#x27;</span>, <span class="keyword">NULL</span>);</span><br></pre></td></tr></table></figure>

<p>运行CodeGenerator的main方法，输入表名：m_user，生成结果如下：</p>
<p><img src="https://image-1300566513.cos.ap-guangzhou.myqcloud.com/upload/images/20201117/47682f628eae4c3588f6729e1df322af.png" alt="图片"></p>
<p>得到：</p>
<p><img src="https://image-1300566513.cos.ap-guangzhou.myqcloud.com/upload/images/20201117/f5e4daec518044619c0d374daa844f40.png" alt="图片"></p>
<p>简洁！方便！经过上面的步骤，基本上我们已经把mybatis plus框架集成到项目中了。</p>
<p>ps：额，注意一下m_blog表的代码也生成一下哈。</p>
<p>在UserController中写个测试：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;/user&quot;)</span><br><span class="line">public class UserController &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    UserService userService;</span><br><span class="line">    @GetMapping(&quot;/&#123;id&#125;&quot;)</span><br><span class="line">    public Object test(@PathVariable(&quot;id&quot;) Long id) &#123;</span><br><span class="line">        return userService.getById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>访问：<a target="_blank" rel="noopener" href="http://localhost:8080/user/1">http://localhost:8080/user/1</a> 获得结果如下，整合成功！<br><img src="https://image-1300566513.cos.ap-guangzhou.myqcloud.com/upload/images/20201117/ecb8c3a623694595a22980a26821ccb6.png" alt="图片"></p>
<h3 id="3、统一结果封装"><a href="#3、统一结果封装" class="headerlink" title="3、统一结果封装"></a>3、统一结果封装</h3><p>这里我们用到了一个Result的类，这个用于我们的异步统一返回的结果封装。一般来说，结果里面有几个要素必要的</p>
<ul>
<li>是否成功，可用code表示（如200表示成功，400表示异常）</li>
<li>结果消息</li>
<li>结果数据</li>
</ul>
<p>所以可得到封装如下：</p>
<ul>
<li>com.markerhub.common.lang.Result</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">public class Result implements Serializable &#123;</span><br><span class="line">    private String code;</span><br><span class="line">    private String msg;</span><br><span class="line">    private Object data;</span><br><span class="line">    public static Result succ(Object data) &#123;</span><br><span class="line">        Result m = new Result();</span><br><span class="line">        m.setCode(&quot;0&quot;);</span><br><span class="line">        m.setData(data);</span><br><span class="line">        m.setMsg(&quot;操作成功&quot;);</span><br><span class="line">        return m;</span><br><span class="line">    &#125;</span><br><span class="line">    public static Result succ(String mess, Object data) &#123;</span><br><span class="line">        Result m = new Result();</span><br><span class="line">        m.setCode(&quot;0&quot;);</span><br><span class="line">        m.setData(data);</span><br><span class="line">        m.setMsg(mess);</span><br><span class="line">        return m;</span><br><span class="line">    &#125;</span><br><span class="line">    public static Result fail(String mess) &#123;</span><br><span class="line">        Result m = new Result();</span><br><span class="line">        m.setCode(&quot;-1&quot;);</span><br><span class="line">        m.setData(null);</span><br><span class="line">        m.setMsg(mess);</span><br><span class="line">        return m;</span><br><span class="line">    &#125;</span><br><span class="line">    public static Result fail(String mess, Object data) &#123;</span><br><span class="line">        Result m = new Result();</span><br><span class="line">        m.setCode(&quot;-1&quot;);</span><br><span class="line">        m.setData(data);</span><br><span class="line">        m.setMsg(mess);</span><br><span class="line">        return m;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4、整合shiro-jwt，并会话共享"><a href="#4、整合shiro-jwt，并会话共享" class="headerlink" title="4、整合shiro+jwt，并会话共享"></a>4、整合shiro+jwt，并会话共享</h3><p>考虑到后面可能需要做集群、负载均衡等，所以就需要会话共享，而shiro的缓存和会话信息，我们一般考虑使用redis来存储这些数据，所以，我们不仅仅需要整合shiro，同时也需要整合redis。在开源的项目中，我们找到了一个starter可以快速整合shiro-redis，配置简单，这里也推荐大家使用。</p>
<p>而因为我们需要做的是前后端分离项目的骨架，所以一般我们会采用token或者jwt作为跨域身份验证解决方案。所以整合shiro的过程中，我们需要引入jwt的身份验证过程。</p>
<p>那么我们就开始整合：</p>
<p>我们使用一个shiro-redis-spring-boot-starter的jar包，具体教程可以看官方文档：<a target="_blank" rel="noopener" href="https://github.com/alexxiyang/shiro-redis/blob/master/docs/README.md#spring-boot-starter">https://github.com/alexxiyang/shiro-redis/blob/master/docs/README.md#spring-boot-starter</a></p>
<p>第一步：导入shiro-redis的starter包：还有jwt的工具包，以及为了简化开发，我引入了hutool工具包。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.crazycake&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;shiro-redis-spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.2.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- hutool工具类--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;cn.hutool&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;hutool-all&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.3.3&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!-- jwt --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;io.jsonwebtoken&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jjwt&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;0.9.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>第二步：编写配置：</p>
<h4 id="ShiroConfig"><a href="#ShiroConfig" class="headerlink" title="ShiroConfig"></a>ShiroConfig</h4><ul>
<li>com.markerhub.config.ShiroConfig</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * shiro启用注解拦截控制器</span><br><span class="line"> */</span><br><span class="line">@Configuration</span><br><span class="line">public class ShiroConfig &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    JwtFilter jwtFilter;</span><br><span class="line">    @Bean</span><br><span class="line">    public SessionManager sessionManager(RedisSessionDAO redisSessionDAO) &#123;</span><br><span class="line">        DefaultWebSessionManager sessionManager = new DefaultWebSessionManager();</span><br><span class="line">        sessionManager.setSessionDAO(redisSessionDAO);</span><br><span class="line">        return sessionManager;</span><br><span class="line">    &#125;</span><br><span class="line">    @Bean</span><br><span class="line">    public DefaultWebSecurityManager securityManager(AccountRealm accountRealm,</span><br><span class="line">                                                     SessionManager sessionManager,</span><br><span class="line">                                                     RedisCacheManager redisCacheManager) &#123;</span><br><span class="line">        DefaultWebSecurityManager securityManager = new DefaultWebSecurityManager(accountRealm);</span><br><span class="line">        securityManager.setSessionManager(sessionManager);</span><br><span class="line">        securityManager.setCacheManager(redisCacheManager);</span><br><span class="line">        /*</span><br><span class="line">         * 关闭shiro自带的session，详情见文档</span><br><span class="line">         */</span><br><span class="line">        DefaultSubjectDAO subjectDAO = new DefaultSubjectDAO();</span><br><span class="line">        DefaultSessionStorageEvaluator defaultSessionStorageEvaluator = new DefaultSessionStorageEvaluator();</span><br><span class="line">        defaultSessionStorageEvaluator.setSessionStorageEnabled(false);</span><br><span class="line">        subjectDAO.setSessionStorageEvaluator(defaultSessionStorageEvaluator);</span><br><span class="line">        securityManager.setSubjectDAO(subjectDAO);</span><br><span class="line">        return securityManager;</span><br><span class="line">    &#125;</span><br><span class="line">    @Bean</span><br><span class="line">    public ShiroFilterChainDefinition shiroFilterChainDefinition() &#123;</span><br><span class="line">        DefaultShiroFilterChainDefinition chainDefinition = new DefaultShiroFilterChainDefinition();</span><br><span class="line">        Map&lt;String, String&gt; filterMap = new LinkedHashMap&lt;&gt;();</span><br><span class="line">        filterMap.put(&quot;/**&quot;, &quot;jwt&quot;); // 主要通过注解方式校验权限</span><br><span class="line">        chainDefinition.addPathDefinitions(filterMap);</span><br><span class="line">        return chainDefinition;</span><br><span class="line">    &#125;</span><br><span class="line">    @Bean(&quot;shiroFilterFactoryBean&quot;)</span><br><span class="line">    public ShiroFilterFactoryBean shiroFilterFactoryBean(SecurityManager securityManager,</span><br><span class="line">                                                         ShiroFilterChainDefinition shiroFilterChainDefinition) &#123;</span><br><span class="line">        ShiroFilterFactoryBean shiroFilter = new ShiroFilterFactoryBean();</span><br><span class="line">        shiroFilter.setSecurityManager(securityManager);</span><br><span class="line">        Map&lt;String, Filter&gt; filters = new HashMap&lt;&gt;();</span><br><span class="line">        filters.put(&quot;jwt&quot;, jwtFilter);</span><br><span class="line">        shiroFilter.setFilters(filters);</span><br><span class="line">        Map&lt;String, String&gt; filterMap = shiroFilterChainDefinition.getFilterChainMap();</span><br><span class="line">        shiroFilter.setFilterChainDefinitionMap(filterMap);</span><br><span class="line">        return shiroFilter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 开启注解代理（默认好像已经开启，可以不要）</span><br><span class="line">    @Bean</span><br><span class="line">    public AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor(SecurityManager securityManager)&#123;</span><br><span class="line">        AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor = new AuthorizationAttributeSourceAdvisor();</span><br><span class="line">        authorizationAttributeSourceAdvisor.setSecurityManager(securityManager);</span><br><span class="line">        return authorizationAttributeSourceAdvisor;</span><br><span class="line">    &#125;</span><br><span class="line">    @Bean</span><br><span class="line">    public static DefaultAdvisorAutoProxyCreator getDefaultAdvisorAutoProxyCreator() &#123;</span><br><span class="line">        DefaultAdvisorAutoProxyCreator creator = new DefaultAdvisorAutoProxyCreator();</span><br><span class="line">        return creator;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面ShiroConfig，我们主要做了几件事情：</p>
<ol>
<li>引入RedisSessionDAO和RedisCacheManager，为了解决shiro的权限数据和会话信息能保存到redis中，实现会话共享。</li>
<li>重写了SessionManager和DefaultWebSecurityManager，同时在DefaultWebSecurityManager中为了关闭shiro自带的session方式，我们需要设置为false，这样用户就不再能通过session方式登录shiro。后面将采用jwt凭证登录。</li>
<li>在ShiroFilterChainDefinition中，我们不再通过编码形式拦截Controller访问路径，而是所有的路由都需要经过JwtFilter这个过滤器，然后判断请求头中是否含有jwt的信息，有就登录，没有就跳过。跳过之后，有Controller中的shiro注解进行再次拦截，比如<a target="_blank" rel="noopener" href="https://github.com/RequiresAuthentication">@RequiresAuthentication</a>，这样控制权限访问。</li>
</ol>
<p>那么，接下来，我们聊聊ShiroConfig中出现的AccountRealm，还有JwtFilter。</p>
<h4 id="AccountRealm"><a href="#AccountRealm" class="headerlink" title="AccountRealm"></a>AccountRealm</h4><p>AccountRealm是shiro进行登录或者权限校验的逻辑所在，算是核心了，我们需要重写3个方法，分别是</p>
<ul>
<li>supports：为了让realm支持jwt的凭证校验</li>
<li>doGetAuthorizationInfo：权限校验</li>
<li>doGetAuthenticationInfo：登录认证校验</li>
</ul>
<p>我们先来总体看看AccountRealm的代码，然后逐个分析：</p>
<ul>
<li>com.markerhub.shiro.AccountRealm</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">@Slf4j</span><br><span class="line">@Component</span><br><span class="line">public class AccountRealm extends AuthorizingRealm &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    JwtUtils jwtUtils;</span><br><span class="line">    @Autowired</span><br><span class="line">    UserService userService;</span><br><span class="line">    @Override</span><br><span class="line">    public boolean supports(AuthenticationToken token) &#123;</span><br><span class="line">        return token instanceof JwtToken;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principals) &#123;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken token) throws AuthenticationException &#123;</span><br><span class="line">        JwtToken jwt = (JwtToken) token;</span><br><span class="line">        log.info(&quot;jwt-----------------&gt;&#123;&#125;&quot;, jwt);</span><br><span class="line">        String userId = jwtUtils.getClaimByToken((String) jwt.getPrincipal()).getSubject();</span><br><span class="line">        User user = userService.getById(Long.parseLong(userId));</span><br><span class="line">        if(user == null) &#123;</span><br><span class="line">            throw new UnknownAccountException(&quot;账户不存在！&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        if(user.getStatus() == -1) &#123;</span><br><span class="line">            throw new LockedAccountException(&quot;账户已被锁定！&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        AccountProfile profile = new AccountProfile();</span><br><span class="line">        BeanUtil.copyProperties(user, profile);</span><br><span class="line">        log.info(&quot;profile-----------------&gt;&#123;&#125;&quot;, profile.toString());</span><br><span class="line">        return new SimpleAuthenticationInfo(profile, jwt.getCredentials(), getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其实主要就是doGetAuthenticationInfo登录认证这个方法，可以看到我们通过jwt获取到用户信息，判断用户的状态，最后异常就抛出对应的异常信息，否者封装成SimpleAuthenticationInfo返回给shiro。<br>接下来我们逐步分析里面出现的新类：</p>
<p>1、shiro默认supports的是UsernamePasswordToken，而我们现在采用了jwt的方式，所以这里我们自定义一个JwtToken，来完成shiro的supports方法。</p>
<h4 id="JwtToken"><a href="#JwtToken" class="headerlink" title="JwtToken"></a>JwtToken</h4><ul>
<li>com.markerhub.shiro.JwtToken</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public class JwtToken implements AuthenticationToken &#123;</span><br><span class="line">    private String token;</span><br><span class="line">    public JwtToken(String token) &#123;</span><br><span class="line">        this.token = token;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public Object getPrincipal() &#123;</span><br><span class="line">        return token;</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    public Object getCredentials() &#123;</span><br><span class="line">        return token;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2、JwtUtils是个生成和校验jwt的工具类，其中有些jwt相关的密钥信息是从项目配置文件中配置的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">@ConfigurationProperties(prefix = &quot;markerhub.jwt&quot;)</span><br><span class="line">public class JwtUtils &#123;</span><br><span class="line">    private String secret;</span><br><span class="line">    private long expire;</span><br><span class="line">    private String header;</span><br><span class="line">    /**</span><br><span class="line">     * 生成jwt token</span><br><span class="line">     */</span><br><span class="line">    public String generateToken(long userId) &#123;</span><br><span class="line">    ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 获取jwt的信息</span><br><span class="line">    public Claims getClaimByToken(String token) &#123;</span><br><span class="line">    ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * token是否过期</span><br><span class="line">     * @return  true：过期</span><br><span class="line">     */</span><br><span class="line">    public boolean isTokenExpired(Date expiration) &#123;</span><br><span class="line">        return expiration.before(new Date());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3、而在AccountRealm我们还用到了AccountProfile，这是为了登录成功之后返回的一个用户信息的载体，</p>
<h4 id="AccountProfile"><a href="#AccountProfile" class="headerlink" title="AccountProfile"></a>AccountProfile</h4><ul>
<li>com.markerhub.shiro.AccountProfile</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">public class AccountProfile implements Serializable &#123;</span><br><span class="line">    private Long id;</span><br><span class="line">    private String username;</span><br><span class="line">    private String avatar;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第三步，ok，基本的校验的路线完成之后，我们需要少量的基本信息配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">shiro-redis:</span><br><span class="line">  enabled: true</span><br><span class="line">  redis-manager:</span><br><span class="line">    host: 127.0.0.1:6379</span><br><span class="line">markerhub:</span><br><span class="line">  jwt:</span><br><span class="line">    # 加密秘钥</span><br><span class="line">    secret: f4e2e52034348f86b67cde581c0f9eb5</span><br><span class="line">    # token有效时长，7天，单位秒</span><br><span class="line">    expire: 604800</span><br><span class="line">    header: token</span><br></pre></td></tr></table></figure>

<p>第四步：另外，如果你项目有使用spring-boot-devtools，需要添加一个配置文件，在resources目录下新建文件夹META-INF，然后新建文件spring-devtools.properties，这样热重启时候才不会报错。</p>
<ul>
<li>resources&#x2F;META-INF&#x2F;spring-devtools.properties</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">restart.include.shiro-redis=/shiro-[\\w-\\.]+jar</span><br></pre></td></tr></table></figure>

<p><img src="https://image-1300566513.cos.ap-guangzhou.myqcloud.com/upload/images/20201117/f227ba4a47614a6ea2f849a56fcb352d.png" alt="图片"></p>
<h4 id="JwtFilter"><a href="#JwtFilter" class="headerlink" title="JwtFilter"></a>JwtFilter</h4><p>第五步：定义jwt的过滤器JwtFilter。</p>
<p>这个过滤器是我们的重点，这里我们继承的是Shiro内置的AuthenticatingFilter，一个可以内置了可以自动登录方法的的过滤器，有些同学继承BasicHttpAuthenticationFilter也是可以的。</p>
<p>我们需要重写几个方法：</p>
<ol>
<li>createToken：实现登录，我们需要生成我们自定义支持的JwtToken</li>
<li>onAccessDenied：拦截校验，当头部没有Authorization时候，我们直接通过，不需要自动登录；当带有的时候，首先我们校验jwt的有效性，没问题我们就直接执行executeLogin方法实现自动登录</li>
<li>onLoginFailure：登录异常时候进入的方法，我们直接把异常信息封装然后抛出</li>
<li>preHandle：拦截器的前置拦截，因为我们是前后端分析项目，项目中除了需要跨域全局配置之外，我们再拦截器中也需要提供跨域支持。这样，拦截器才不会在进入Controller之前就被限制了。</li>
</ol>
<p>下面我们看看总体的代码：</p>
<ul>
<li>com.markerhub.shiro.JwtFilter</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">public class JwtFilter extends AuthenticatingFilter &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    JwtUtils jwtUtils;</span><br><span class="line">    @Override</span><br><span class="line">    protected AuthenticationToken createToken(ServletRequest servletRequest, ServletResponse servletResponse) throws Exception &#123;</span><br><span class="line">        // 获取 token</span><br><span class="line">        HttpServletRequest request = (HttpServletRequest) servletRequest;</span><br><span class="line">        String jwt = request.getHeader(&quot;Authorization&quot;);</span><br><span class="line">        if(StringUtils.isEmpty(jwt))&#123;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">        return new JwtToken(jwt);</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    protected boolean onAccessDenied(ServletRequest servletRequest, ServletResponse servletResponse) throws Exception &#123;</span><br><span class="line">        HttpServletRequest request = (HttpServletRequest) servletRequest;</span><br><span class="line">        String token = request.getHeader(&quot;Authorization&quot;);</span><br><span class="line">        if(StringUtils.isEmpty(token)) &#123;</span><br><span class="line">            return true;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            // 判断是否已过期</span><br><span class="line">            Claims claim = jwtUtils.getClaimByToken(token);</span><br><span class="line">            if(claim == null || jwtUtils.isTokenExpired(claim.getExpiration())) &#123;</span><br><span class="line">                throw new ExpiredCredentialsException(&quot;token已失效，请重新登录！&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        // 执行自动登录</span><br><span class="line">        return executeLogin(servletRequest, servletResponse);</span><br><span class="line">    &#125;</span><br><span class="line">    @Override</span><br><span class="line">    protected boolean onLoginFailure(AuthenticationToken token, AuthenticationException e, ServletRequest request, ServletResponse response) &#123;</span><br><span class="line">        HttpServletResponse httpResponse = (HttpServletResponse) response;</span><br><span class="line">        try &#123;</span><br><span class="line">            //处理登录失败的异常</span><br><span class="line">            Throwable throwable = e.getCause() == null ? e : e.getCause();</span><br><span class="line">            Result r = Result.fail(throwable.getMessage());</span><br><span class="line">            String json = JSONUtil.toJsonStr(r);</span><br><span class="line">            httpResponse.getWriter().print(json);</span><br><span class="line">        &#125; catch (IOException e1) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * 对跨域提供支持</span><br><span class="line">     */</span><br><span class="line">    @Override</span><br><span class="line">    protected boolean preHandle(ServletRequest request, ServletResponse response) throws Exception &#123;</span><br><span class="line">        HttpServletRequest httpServletRequest = WebUtils.toHttp(request);</span><br><span class="line">        HttpServletResponse httpServletResponse = WebUtils.toHttp(response);</span><br><span class="line">        httpServletResponse.setHeader(&quot;Access-control-Allow-Origin&quot;, httpServletRequest.getHeader(&quot;Origin&quot;));</span><br><span class="line">        httpServletResponse.setHeader(&quot;Access-Control-Allow-Methods&quot;, &quot;GET,POST,OPTIONS,PUT,DELETE&quot;);</span><br><span class="line">        httpServletResponse.setHeader(&quot;Access-Control-Allow-Headers&quot;, httpServletRequest.getHeader(&quot;Access-Control-Request-Headers&quot;));</span><br><span class="line">        // 跨域时会首先发送一个OPTIONS请求，这里我们给OPTIONS请求直接返回正常状态</span><br><span class="line">        if (httpServletRequest.getMethod().equals(RequestMethod.OPTIONS.name())) &#123;</span><br><span class="line">            httpServletResponse.setStatus(org.springframework.http.HttpStatus.OK.value());</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        return super.preHandle(request, response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>那么到这里，我们的shiro就已经完成整合进来了，并且使用了jwt进行身份校验。</p>
<h3 id="5、异常处理"><a href="#5、异常处理" class="headerlink" title="5、异常处理"></a>5、异常处理</h3><p>有时候不可避免服务器报错的情况，如果不配置异常处理机制，就会默认返回tomcat或者nginx的5XX页面，对普通用户来说，不太友好，用户也不懂什么情况。这时候需要我们程序员设计返回一个友好简单的格式给前端。</p>
<p>处理办法如下：通过使用<a target="_blank" rel="noopener" href="https://github.com/ControllerAdvice">@ControllerAdvice</a>来进行统一异常处理，<a target="_blank" rel="noopener" href="https://github.com/ExceptionHandler">@ExceptionHandler</a>(value &#x3D; RuntimeException.class)来指定捕获的Exception各个类型异常 ，这个异常的处理，是全局的，所有类似的异常，都会跑到这个地方处理。</p>
<ul>
<li>com.markerhub.common.exception.GlobalExceptionHandler</li>
</ul>
<p>步骤二、定义全局异常处理，<a target="_blank" rel="noopener" href="https://github.com/ControllerAdvice">@ControllerAdvice</a>表示定义全局控制器异常处理，<a target="_blank" rel="noopener" href="https://github.com/ExceptionHandler">@ExceptionHandler</a>表示针对性异常处理，可对每种异常针对性处理。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 全局异常处理</span><br><span class="line"> */</span><br><span class="line">@Slf4j</span><br><span class="line">@RestControllerAdvice</span><br><span class="line">public class GlobalExcepitonHandler &#123;</span><br><span class="line">    // 捕捉shiro的异常</span><br><span class="line">    @ResponseStatus(HttpStatus.UNAUTHORIZED)</span><br><span class="line">    @ExceptionHandler(ShiroException.class)</span><br><span class="line">    public Result handle401(ShiroException e) &#123;</span><br><span class="line">        return Result.fail(401, e.getMessage(), null);</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * 处理Assert的异常</span><br><span class="line">     */</span><br><span class="line">    @ResponseStatus(HttpStatus.BAD_REQUEST)</span><br><span class="line">    @ExceptionHandler(value = IllegalArgumentException.class)</span><br><span class="line">    public Result handler(IllegalArgumentException e) throws IOException &#123;</span><br><span class="line">        log.error(&quot;Assert异常:--------------&gt;&#123;&#125;&quot;,e.getMessage());</span><br><span class="line">        return Result.fail(e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * @Validated 校验错误异常处理</span><br><span class="line">     */</span><br><span class="line">    @ResponseStatus(HttpStatus.BAD_REQUEST)</span><br><span class="line">    @ExceptionHandler(value = MethodArgumentNotValidException.class)</span><br><span class="line">    public Result handler(MethodArgumentNotValidException e) throws IOException &#123;</span><br><span class="line">        log.error(&quot;运行时异常:--------------&gt;&quot;,e);</span><br><span class="line">        BindingResult bindingResult = e.getBindingResult();</span><br><span class="line">        ObjectError objectError = bindingResult.getAllErrors().stream().findFirst().get();</span><br><span class="line">        return Result.fail(objectError.getDefaultMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @ResponseStatus(HttpStatus.BAD_REQUEST)</span><br><span class="line">    @ExceptionHandler(value = RuntimeException.class)</span><br><span class="line">    public Result handler(RuntimeException e) throws IOException &#123;</span><br><span class="line">        log.error(&quot;运行时异常:--------------&gt;&quot;,e);</span><br><span class="line">        return Result.fail(e.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面我们捕捉了几个异常：</p>
<ul>
<li>ShiroException：shiro抛出的异常，比如没有权限，用户登录异常</li>
<li>IllegalArgumentException：处理Assert的异常</li>
<li>MethodArgumentNotValidException：处理实体校验的异常</li>
<li>RuntimeException：捕捉其他异常</li>
</ul>
<h3 id="6、实体校验"><a href="#6、实体校验" class="headerlink" title="6、实体校验"></a>6、实体校验</h3><p>当我们表单数据提交的时候，前端的校验我们可以使用一些类似于jQuery Validate等js插件实现，而后端我们可以使用Hibernate validatior来做校验。</p>
<p>我们使用springboot框架作为基础，那么就已经自动集成了Hibernate validatior。</p>
<p>那么用起来啥样子的呢？</p>
<p>第一步：首先在实体的属性上添加对应的校验规则，比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@TableName(&quot;m_user&quot;)</span><br><span class="line">public class User implements Serializable &#123;</span><br><span class="line">    private static final long serialVersionUID = 1L;</span><br><span class="line">    @TableId(value = &quot;id&quot;, type = IdType.AUTO)</span><br><span class="line">    private Long id;</span><br><span class="line">    @NotBlank(message = &quot;昵称不能为空&quot;)</span><br><span class="line">    private String username;</span><br><span class="line">    @NotBlank(message = &quot;邮箱不能为空&quot;)</span><br><span class="line">    @Email(message = &quot;邮箱格式不正确&quot;)</span><br><span class="line">    private String email;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第二步 ：这里我们使用<a target="_blank" rel="noopener" href="https://github.com/Validated">@Validated</a>注解方式，如果实体不符合要求，系统会抛出异常，那么我们的异常处理中就捕获到MethodArgumentNotValidException。</p>
<ul>
<li>com.markerhub.controller.UserController</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 测试实体校验</span><br><span class="line"> * @param user</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">@PostMapping(&quot;/save&quot;)</span><br><span class="line">public Object testUser(@Validated @RequestBody User user) &#123;</span><br><span class="line">    return user.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7、跨域问题"><a href="#7、跨域问题" class="headerlink" title="7、跨域问题"></a>7、跨域问题</h3><p>因为是前后端分析，所以跨域问题是避免不了的，我们直接在后台进行全局跨域处理：</p>
<ul>
<li>com.markerhub.config.CorsConfig</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 解决跨域问题</span><br><span class="line"> */</span><br><span class="line">@Configuration</span><br><span class="line">public class CorsConfig implements WebMvcConfigurer &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void addCorsMappings(CorsRegistry registry) &#123;</span><br><span class="line">        registry.addMapping(&quot;/**&quot;)</span><br><span class="line">                .allowedOrigins(&quot;*&quot;)</span><br><span class="line">                .allowedMethods(&quot;GET&quot;, &quot;HEAD&quot;, &quot;POST&quot;, &quot;PUT&quot;, &quot;DELETE&quot;, &quot;OPTIONS&quot;)</span><br><span class="line">                .allowCredentials(true)</span><br><span class="line">                .maxAge(3600)</span><br><span class="line">                .allowedHeaders(&quot;*&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ok，因为我们系统开发的接口比较简单，所以我就不集成swagger2啦，也比较简单而已。下面我们就直接进入我们的正题，进行编写登录接口。</p>
<h3 id="8、登录接口开发"><a href="#8、登录接口开发" class="headerlink" title="8、登录接口开发"></a>8、登录接口开发</h3><p>登录的逻辑其实很简答，只需要接受账号密码，然后把用户的id生成jwt，返回给前段，为了后续的jwt的延期，所以我们把jwt放在header上。具体代码如下：</p>
<ul>
<li>com.markerhub.controller.AccountController</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">public class AccountController &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    JwtUtils jwtUtils;</span><br><span class="line">    @Autowired</span><br><span class="line">    UserService userService;</span><br><span class="line">    /**</span><br><span class="line">     * 默认账号密码：markerhub / 111111</span><br><span class="line">     *</span><br><span class="line">     */</span><br><span class="line">    @CrossOrigin</span><br><span class="line">    @PostMapping(&quot;/login&quot;)</span><br><span class="line">    public Result login(@Validated @RequestBody LoginDto loginDto, HttpServletResponse response) &#123;</span><br><span class="line">        User user = userService.getOne(new QueryWrapper&lt;User&gt;().eq(&quot;username&quot;, loginDto.getUsername()));</span><br><span class="line">        Assert.notNull(user, &quot;用户不存在&quot;);</span><br><span class="line">        if(!user.getPassword().equals(SecureUtil.md5(loginDto.getPassword()))) &#123;</span><br><span class="line">            return Result.fail(&quot;密码错误！&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        String jwt = jwtUtils.generateToken(user.getId());</span><br><span class="line">        response.setHeader(&quot;Authorization&quot;, jwt);</span><br><span class="line">        response.setHeader(&quot;Access-Control-Expose-Headers&quot;, &quot;Authorization&quot;);</span><br><span class="line">        // 用户可以另一个接口</span><br><span class="line">        return Result.succ(MapUtil.builder()</span><br><span class="line">                .put(&quot;id&quot;, user.getId())</span><br><span class="line">                .put(&quot;username&quot;, user.getUsername())</span><br><span class="line">                .put(&quot;avatar&quot;, user.getAvatar())</span><br><span class="line">                .put(&quot;email&quot;, user.getEmail())</span><br><span class="line">                .map()</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 退出</span><br><span class="line">    @GetMapping(&quot;/logout&quot;)</span><br><span class="line">    @RequiresAuthentication</span><br><span class="line">    public Result logout() &#123;</span><br><span class="line">        SecurityUtils.getSubject().logout();</span><br><span class="line">        return Result.succ(null);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接口测试：<br><img src="https://image-1300566513.cos.ap-guangzhou.myqcloud.com/upload/images/20201117/5000047b0a874b09850c4ffde0053c8d.png" alt="图片"></p>
<h3 id="9、博客接口开发"><a href="#9、博客接口开发" class="headerlink" title="9、博客接口开发"></a>9、博客接口开发</h3><p>我们的骨架已经完成，接下来，我们就可以添加我们的业务接口了，下面我以一个简单的博客列表、博客详情页为例子开发：</p>
<ul>
<li>com.markerhub.controller.BlogController</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">@RestController</span><br><span class="line">public class BlogController &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    BlogService blogService;</span><br><span class="line">    @GetMapping(&quot;/blogs&quot;)</span><br><span class="line">    public Result blogs(Integer currentPage) &#123;</span><br><span class="line">        if(currentPage == null || currentPage &lt; 1) currentPage = 1;</span><br><span class="line">        Page page = new Page(currentPage, 5)</span><br><span class="line">        IPage pageData = blogService.page(page, new QueryWrapper&lt;Blog&gt;().orderByDesc(&quot;created&quot;));</span><br><span class="line">        return Result.succ(pageData);</span><br><span class="line">    &#125;</span><br><span class="line">    @GetMapping(&quot;/blog/&#123;id&#125;&quot;)</span><br><span class="line">    public Result detail(@PathVariable(name = &quot;id&quot;) Long id) &#123;</span><br><span class="line">        Blog blog = blogService.getById(id);</span><br><span class="line">        Assert.notNull(blog, &quot;该博客已删除！&quot;);</span><br><span class="line">        return Result.succ(blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @RequiresAuthentication</span><br><span class="line">@PostMapping(&quot;/blog/edit&quot;)</span><br><span class="line">public Result edit(@Validated @RequestBody Blog blog) &#123;</span><br><span class="line">    System.out.println(blog.toString());</span><br><span class="line">    Blog temp = null;</span><br><span class="line">    if(blog.getId() != null) &#123;</span><br><span class="line">        temp = blogService.getById(blog.getId());</span><br><span class="line">        Assert.isTrue(temp.getUserId() == ShiroUtil.getProfile().getId(), &quot;没有权限编辑&quot;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        temp = new Blog();</span><br><span class="line">        temp.setUserId(ShiroUtil.getProfile().getId());</span><br><span class="line">        temp.setCreated(LocalDateTime.now());</span><br><span class="line">        temp.setStatus(0);</span><br><span class="line">    &#125;</span><br><span class="line">    BeanUtil.copyProperties(blog, temp, &quot;id&quot;, &quot;userId&quot;, &quot;created&quot;, &quot;status&quot;);</span><br><span class="line">    blogService.saveOrUpdate(temp);</span><br><span class="line">    return Result.succ(&quot;操作成功&quot;, null);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意<a target="_blank" rel="noopener" href="https://github.com/RequiresAuthentication">@RequiresAuthentication</a>说明需要登录之后才能访问的接口，其他需要权限的接口可以添加shiro的相关注解。<br>接口比较简单，我们就不多说了，基本增删改查而已。注意的是edit方法是需要登录才能操作的受限资源。</p>
<p>接口测试：</p>
<p><img src="https://image-1300566513.cos.ap-guangzhou.myqcloud.com/upload/images/20201117/f9269851970c43d096d3c777730fffde.png" alt="图片"></p>
<h3 id="10、后端总结"><a href="#10、后端总结" class="headerlink" title="10、后端总结"></a>10、后端总结</h3><p>好了，一篇文章搞定一个基本骨架，好像有点赶，但是基本的东西这里已经有了。后面我们就要去开发我们的前端接口了。</p>
<p>项目代码：<a target="_blank" rel="noopener" href="https://github.com/MarkerHub/vueblog">https://github.com/MarkerHub/vueblog</a></p>
<p>项目视频：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1PQ4y1P7hZ/">https://www.bilibili.com/video/BV1PQ4y1P7hZ/</a></p>
<h2 id="Vue前端页面开发"><a href="#Vue前端页面开发" class="headerlink" title="Vue前端页面开发"></a>Vue前端页面开发</h2><h3 id="1、前言-1"><a href="#1、前言-1" class="headerlink" title="1、前言"></a>1、前言</h3><p>接下来，我们来完成vueblog前端的部分功能。可能会使用的到技术如下：</p>
<ul>
<li>vue</li>
<li>element-ui</li>
<li>axios</li>
<li>mavon-editor</li>
<li>markdown-it</li>
<li>github-markdown-css</li>
</ul>
<p>本项目实践需要一点点vue的基础，希望你对vue的一些指令有所了解，这样我们讲解起来就简单多了哈。</p>
<h3 id="2、项目演示"><a href="#2、项目演示" class="headerlink" title="2、项目演示"></a>2、项目演示</h3><p>我们先来看下我们需要完成的项目长什么样子，考虑到很多同学的样式的掌握程度不够，所以我尽量使用了element-ui的原生组件的样式来完成整个博客的界面。不多说，直接上图：</p>
<p>在线体验：<a target="_blank" rel="noopener" href="https://markerhub.com:8083/">https://markerhub.com:8083</a></p>
<p><img src="https://image-1300566513.cos.ap-guangzhou.myqcloud.com/upload/images/20201117/068bbd1dcddb40b79c54b02cc5516dfd.png" alt="图片"></p>
<p><img src="https://image-1300566513.cos.ap-guangzhou.myqcloud.com/upload/images/20201117/c1fe32b559cf4b39a2be26b3990b884a.png" alt="图片"></p>
<p><img src="https://image-1300566513.cos.ap-guangzhou.myqcloud.com/upload/images/20201117/b66dbd5169fd4f8f94109aa1bd65f48f.png" alt="图片"></p>
<h3 id="3、环境准备"><a href="#3、环境准备" class="headerlink" title="3、环境准备"></a>3、环境准备</h3><p>万丈高楼平地起，我们下面一步一步来完成，首先我们安装vue的环境，我实践的环境是windows 10哈。</p>
<p>1、首先我们上node.js官网(<a target="_blank" rel="noopener" href="https://nodejs.org/zh-cn/)%EF%BC%8C%E4%B8%8B%E8%BD%BD%E6%9C%80%E6%96%B0%E7%9A%84%E9%95%BF%E6%9C%9F%E7%89%88%E6%9C%AC%EF%BC%8C%E7%9B%B4%E6%8E%A5%E8%BF%90%E8%A1%8C%E5%AE%89%E8%A3%85%E5%AE%8C%E6%88%90%E4%B9%8B%E5%90%8E%EF%BC%8C%E6%88%91%E4%BB%AC%E5%B0%B1%E5%B7%B2%E7%BB%8F%E5%85%B7%E5%A4%87%E4%BA%86node%E5%92%8Cnpm%E7%9A%84%E7%8E%AF%E5%A2%83%E5%95%A6%E3%80%82">https://nodejs.org/zh-cn/)，下载最新的长期版本，直接运行安装完成之后，我们就已经具备了node和npm的环境啦。</a></p>
<p><img src="https://image-1300566513.cos.ap-guangzhou.myqcloud.com/upload/images/20201117/5a30fecdf00d47619f99e4d15ed5c983.png" alt="图片"></p>
<p>安装完成之后检查下版本信息：</p>
<p><img src="https://image-1300566513.cos.ap-guangzhou.myqcloud.com/upload/images/20201117/babbc453e8c94bf2b413d370e8ad8989.png" alt="图片"></p>
<p>2、接下来，我们安装vue的环境</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 安装淘宝npm</span><br><span class="line">npm install -g cnpm --registry=https://registry.npm.taobao.org</span><br><span class="line"># vue-cli 安装依赖包</span><br><span class="line">cnpm install --g vue-cli</span><br></pre></td></tr></table></figure>

<h3 id="4、新建项目"><a href="#4、新建项目" class="headerlink" title="4、新建项目"></a>4、新建项目</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 打开vue的可视化管理工具界面</span><br><span class="line">vue ui</span><br></pre></td></tr></table></figure>

<p>上面我们分别安装了淘宝npm，cnpm是为了提高我们安装依赖的速度。vue ui是<a target="_blank" rel="noopener" href="https://github.com/vue">@vue</a>&#x2F;cli3.0增加一个可视化项目管理工具，可以运行项目、打包项目，检查等操作。对于初学者来说，可以少记一些命令，哈哈。<br>3、创建vueblog-vue项目</p>
<p>运行vue ui之后，会为我们打开一个<a target="_blank" rel="noopener" href="http://localhost:8080/">http://localhost:8080</a> 的页面：</p>
<p><img src="https://image-1300566513.cos.ap-guangzhou.myqcloud.com/upload/images/20201117/154ae9db3c0c4d9e9218bc74da7cddec.png" alt="图片"></p>
<p>然后切换到【创建】，注意创建的目录最好是和你运行vue ui同一级。这样方便管理和切换。然后点击按钮【在此创建新羡慕】</p>
<p><img src="https://image-1300566513.cos.ap-guangzhou.myqcloud.com/upload/images/20201117/9e5178bc47cf406fa6a982032fb4e25d.png" alt="图片"></p>
<p>下一步中，项目文件夹中输入项目名称“vueblog-vue”，其他不用改，点击下一步，选择【手动】，再点击下一步，如图点击按钮，勾选上路由Router、状态管理Vuex，去掉js的校验。</p>
<p><img src="https://image-1300566513.cos.ap-guangzhou.myqcloud.com/upload/images/20201117/b6d1d354fa3942458212ca24ed8316d4.png" alt="图片"></p>
<p>下一步中，也选上【Use history mode for router】，点击创建项目，然后弹窗中选择按钮【创建项目，不保存预设】，就进入项目创建啦。</p>
<p>稍等片刻之后，项目就初始化完成了。上面的步骤中，我们创建了一个vue项目，并且安装了Router、Vuex。这样我们后面就可以直接使用。</p>
<p>我们来看下整个vueblog-vue的项目结构</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">├── README.md            项目介绍</span><br><span class="line">├── index.html           入口页面</span><br><span class="line">├── build              构建脚本目录</span><br><span class="line">│  ├── build-server.js         运行本地构建服务器，可以访问构建后的页面</span><br><span class="line">│  ├── build.js            生产环境构建脚本</span><br><span class="line">│  ├── dev-client.js          开发服务器热重载脚本，主要用来实现开发阶段的页面自动刷新</span><br><span class="line">│  ├── dev-server.js          运行本地开发服务器</span><br><span class="line">│  ├── utils.js            构建相关工具方法</span><br><span class="line">│  ├── webpack.base.conf.js      wabpack基础配置</span><br><span class="line">│  ├── webpack.dev.conf.js       wabpack开发环境配置</span><br><span class="line">│  └── webpack.prod.conf.js      wabpack生产环境配置</span><br><span class="line">├── config             项目配置</span><br><span class="line">│  ├── dev.env.js           开发环境变量</span><br><span class="line">│  ├── index.js            项目配置文件</span><br><span class="line">│  ├── prod.env.js           生产环境变量</span><br><span class="line">│  └── test.env.js           测试环境变量</span><br><span class="line">├── mock              mock数据目录</span><br><span class="line">│  └── hello.js</span><br><span class="line">├── package.json          npm包配置文件，里面定义了项目的npm脚本，依赖包等信息</span><br><span class="line">├── src               源码目录 </span><br><span class="line">│  ├── main.js             入口js文件</span><br><span class="line">│  ├── app.vue             根组件</span><br><span class="line">│  ├── components           公共组件目录</span><br><span class="line">│  │  └── title.vue</span><br><span class="line">│  ├── assets             资源目录，这里的资源会被wabpack构建</span><br><span class="line">│  │  └── images</span><br><span class="line">│  │    └── logo.png</span><br><span class="line">│  ├── routes             前端路由</span><br><span class="line">│  │  └── index.js</span><br><span class="line">│  ├── store              应用级数据（state）状态管理</span><br><span class="line">│  │  └── index.js</span><br><span class="line">│  └── views              页面目录</span><br><span class="line">│    ├── hello.vue</span><br><span class="line">│    └── notfound.vue</span><br><span class="line">├── static             纯静态资源，不会被wabpack构建。</span><br><span class="line">└── test              测试文件目录（unit&amp;e2e）</span><br><span class="line">  └── unit              单元测试</span><br><span class="line">    ├── index.js            入口脚本</span><br><span class="line">    ├── karma.conf.js          karma配置文件</span><br><span class="line">    └── specs              单测case目录</span><br><span class="line">      └── Hello.spec.js</span><br></pre></td></tr></table></figure>

<h3 id="5、安装element-ui"><a href="#5、安装element-ui" class="headerlink" title="5、安装element-ui"></a>5、安装element-ui</h3><p>接下来我们引入element-ui组件（<a target="_blank" rel="noopener" href="https://element.eleme.cn/#/zh-CN/component/installation">https://element.eleme.cn</a>），这样我们就可以获得好看的vue组件，开发好看的博客界面。</p>
<p><img src="https://image-1300566513.cos.ap-guangzhou.myqcloud.com/upload/images/20201117/b98ecc8a8cd84e3bbbe382424d25ad27.png" alt="图片"></p>
<p>命令很简单：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 切换到项目根目录</span><br><span class="line">cd vueblog-vue</span><br><span class="line"># 安装element-ui</span><br><span class="line">cnpm install element-ui --save</span><br></pre></td></tr></table></figure>

<p>然后我们打开项目src目录下的main.js，引入element-ui依赖。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import Element from &#x27;element-ui&#x27;</span><br><span class="line">import &quot;element-ui/lib/theme-chalk/index.css&quot;</span><br><span class="line">Vue.use(Element)</span><br></pre></td></tr></table></figure>

<p>这样我们就可以愉快得在官网上选择组件复制代码到我们项目中直接使用啦。</p>
<h3 id="6、安装axios"><a href="#6、安装axios" class="headerlink" title="6、安装axios"></a>6、安装axios</h3><p>接下来，我们来安装axios（<a target="_blank" rel="noopener" href="http://www.axios-js.com/%EF%BC%89%EF%BC%8Caxios%E6%98%AF%E4%B8%80%E4%B8%AA%E5%9F%BA%E4%BA%8E">http://www.axios-js.com/），axios是一个基于</a> promise 的 HTTP 库，这样我们进行前后端对接的时候，使用这个工具可以提高我们的开发效率。</p>
<p>安装命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install axios --save</span><br></pre></td></tr></table></figure>

<p>然后同样我们在main.js中全局引入axios。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import axios from &#x27;axios&#x27;</span><br><span class="line">Vue.prototype.$axios = axios //</span><br></pre></td></tr></table></figure>

<p>组件中，我们就可以通过this.$axios.get()来发起我们的请求了哈。</p>
<h3 id="7、页面路由"><a href="#7、页面路由" class="headerlink" title="7、页面路由"></a>7、页面路由</h3><p>接下来，我们先定义好路由和页面，因为我们只是做一个简单的博客项目，页面比较少，所以我们可以直接先定义好，然后在慢慢开发，这样需要用到链接的地方我们就可以直接可以使用：</p>
<p>我们在views文件夹下定义几个页面：</p>
<ul>
<li>BlogDetail.vue（博客详情页）</li>
<li>BlogEdit.vue（编辑博客）</li>
<li>Blogs.vue（博客列表）</li>
<li>Login.vue（登录页面）</li>
</ul>
<p>然后再路由中心配置：</p>
<ul>
<li>router\index.js</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">import Vue from &#x27;vue&#x27;</span><br><span class="line">import VueRouter from &#x27;vue-router&#x27;</span><br><span class="line">import Login from &#x27;../views/Login.vue&#x27;</span><br><span class="line">import BlogDetail from &#x27;../views/BlogDetail.vue&#x27;</span><br><span class="line">import BlogEdit from &#x27;../views/BlogEdit.vue&#x27;</span><br><span class="line">Vue.use(VueRouter)</span><br><span class="line">const routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: &#x27;/&#x27;,</span><br><span class="line">    name: &#x27;Index&#x27;,</span><br><span class="line">    redirect: &#123; name: &#x27;Blogs&#x27; &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: &#x27;/login&#x27;,</span><br><span class="line">    name: &#x27;Login&#x27;,</span><br><span class="line">    component: Login</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: &#x27;/blogs&#x27;,</span><br><span class="line">    name: &#x27;Blogs&#x27;,</span><br><span class="line">    // 懒加载</span><br><span class="line">    component: () =&gt; import(&#x27;../views/Blogs.vue&#x27;)</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: &#x27;/blog/add&#x27;, // 注意放在 path: &#x27;/blog/:blogId&#x27;之前</span><br><span class="line">    name: &#x27;BlogAdd&#x27;,</span><br><span class="line">    meta: &#123;</span><br><span class="line">      requireAuth: true</span><br><span class="line">    &#125;,</span><br><span class="line">    component: BlogEdit</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: &#x27;/blog/:blogId&#x27;,</span><br><span class="line">    name: &#x27;BlogDetail&#x27;,</span><br><span class="line">    component: BlogDetail</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: &#x27;/blog/:blogId/edit&#x27;,</span><br><span class="line">    name: &#x27;BlogEdit&#x27;,</span><br><span class="line">    meta: &#123;</span><br><span class="line">      requireAuth: true</span><br><span class="line">    &#125;,</span><br><span class="line">    component: BlogEdit</span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line">const router = new VueRouter(&#123;</span><br><span class="line">  mode: &#x27;history&#x27;,</span><br><span class="line">  base: process.env.BASE_URL,</span><br><span class="line">  routes</span><br><span class="line">&#125;)</span><br><span class="line">export default router</span><br></pre></td></tr></table></figure>

<p>接下来我们去开发我们的页面。其中，带有meta：requireAuth: true说明是需要登录字后才能访问的受限资源，后面我们路由权限拦截时候会用到。</p>
<h3 id="8、登录页面"><a href="#8、登录页面" class="headerlink" title="8、登录页面"></a>8、登录页面</h3><p>接下来，我们来搞一个登陆页面，表单组件我们直接在element-ui的官网上找就行了，登陆页面就两个输入框和一个提交按钮，相对简单，然后我们最好带页面的js校验。emmm，我直接贴代码了~~</p>
<ul>
<li>views&#x2F;Login.vue</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-container</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-header</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/blogs&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://www.markerhub.com/dist/images/logo/markerhub-logo.png&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">style</span>=<span class="string">&quot;height: 60%; margin-top: 10px;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-header</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">el-main</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">el-form</span> <span class="attr">:model</span>=<span class="string">&quot;ruleForm&quot;</span> <span class="attr">status-icon</span> <span class="attr">:rules</span>=<span class="string">&quot;rules&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;ruleForm&quot;</span> <span class="attr">label-width</span>=<span class="string">&quot;100px&quot;</span></span></span><br><span class="line"><span class="tag">                 <span class="attr">class</span>=<span class="string">&quot;demo-ruleForm&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;用户名&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;username&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">maxlength</span>=<span class="string">&quot;12&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;ruleForm.username&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-form-item</span> <span class="attr">label</span>=<span class="string">&quot;密码&quot;</span> <span class="attr">prop</span>=<span class="string">&quot;password&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-input</span> <span class="attr">type</span>=<span class="string">&quot;password&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;ruleForm.password&quot;</span> <span class="attr">autocomplete</span>=<span class="string">&quot;off&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-button</span> <span class="attr">type</span>=<span class="string">&quot;primary&quot;</span> @<span class="attr">click</span>=<span class="string">&quot;submitForm(&#x27;ruleForm&#x27;)&quot;</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">el-button</span> @<span class="attr">click</span>=<span class="string">&quot;resetForm(&#x27;ruleForm&#x27;)&quot;</span>&gt;</span>重置<span class="tag">&lt;/<span class="name">el-button</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">el-form-item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">el-form</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">el-main</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">el-container</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  export default &#123;</span><br><span class="line">    name: &#x27;Login&#x27;,</span><br><span class="line">    data() &#123;</span><br><span class="line">      var validatePass = (rule, value, callback) =&gt; &#123;</span><br><span class="line">        if (value === &#x27;&#x27;) &#123;</span><br><span class="line">          callback(new Error(&#x27;请输入密码&#x27;));</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">          callback();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">      return &#123;</span><br><span class="line">        ruleForm: &#123;</span><br><span class="line">          password: &#x27;111111&#x27;,</span><br><span class="line">          username: &#x27;markerhub&#x27;</span><br><span class="line">        &#125;,</span><br><span class="line">        rules: &#123;</span><br><span class="line">          password: [</span><br><span class="line">            &#123;validator: validatePass, trigger: &#x27;blur&#x27;&#125;</span><br><span class="line">          ],</span><br><span class="line">          username: [</span><br><span class="line">            &#123;required: true, message: &#x27;请输入用户名&#x27;, trigger: &#x27;blur&#x27;&#125;,</span><br><span class="line">            &#123;min: 3, max: 12, message: &#x27;长度在 3 到 12 个字符&#x27;, trigger: &#x27;blur&#x27;&#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      submitForm(formName) &#123;</span><br><span class="line">        const _this = this</span><br><span class="line">        this.$refs[formName].validate((valid) =&gt; &#123;</span><br><span class="line">          if (valid) &#123;</span><br><span class="line">            // 提交逻辑</span><br><span class="line">            this.$axios.post(&#x27;http://localhost:8081/login&#x27;, this.ruleForm).then((res)=&gt;&#123;</span><br><span class="line">              const token = res.headers[&#x27;authorization&#x27;]</span><br><span class="line">              _this.$store.commit(&#x27;SET_TOKEN&#x27;, token)</span><br><span class="line">              _this.$store.commit(&#x27;SET_USERINFO&#x27;, res.data.data)</span><br><span class="line">              _this.$router.push(&quot;/blogs&quot;)</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            console.log(&#x27;error submit!!&#x27;);</span><br><span class="line">            return false;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;,</span><br><span class="line">      resetForm(formName) &#123;</span><br><span class="line">        this.$refs[formName].resetFields();</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    mounted() &#123;</span><br><span class="line">      this.$notify(&#123;</span><br><span class="line">        title: &#x27;看这里：&#x27;,</span><br><span class="line">        message: &#x27;关注公众号：MarkerHub，回复【vueblog】，领取项目资料与源码&#x27;,</span><br><span class="line">        duration: 1500</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>找不到啥好的方式讲解了，之后先贴代码，然后再讲解。<br>上面代码中，其实主要做了两件事情</p>
<p>1、表单校验</p>
<p>2、登录按钮的点击登录事件</p>
<p>表单校验规则还好，比较固定写法，查一下element-ui的组件就知道了，我们来分析一下发起登录之后的代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">const token = res.headers[&#x27;authorization&#x27;]</span><br><span class="line">_this.$store.commit(&#x27;SET_TOKEN&#x27;, token)</span><br><span class="line">_this.$store.commit(&#x27;SET_USERINFO&#x27;, res.data.data)</span><br><span class="line">_this.$router.push(&quot;/blogs&quot;)</span><br></pre></td></tr></table></figure>

<p>从返回的结果请求头中获取到token的信息，然后使用store提交token和用户信息的状态。完成操作之后，我们调整到了&#x2F;blogs路由，即博客列表页面。</p>
<h4 id="token的状态同步"><a href="#token的状态同步" class="headerlink" title="token的状态同步"></a>token的状态同步</h4><p>所以在store&#x2F;index.js中，代码是这样的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">import Vue from &#x27;vue&#x27;</span><br><span class="line">import Vuex from &#x27;vuex&#x27;</span><br><span class="line">Vue.use(Vuex)</span><br><span class="line">export default new Vuex.Store(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    token: &#x27;&#x27;,</span><br><span class="line">    userInfo: JSON.parse(sessionStorage.getItem(&quot;userInfo&quot;))</span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line">    SET_TOKEN: (state, token) =&gt; &#123;</span><br><span class="line">      state.token = token</span><br><span class="line">      localStorage.setItem(&quot;token&quot;, token)</span><br><span class="line">    &#125;,</span><br><span class="line">    SET_USERINFO: (state, userInfo) =&gt; &#123;</span><br><span class="line">      state.userInfo = userInfo</span><br><span class="line">      sessionStorage.setItem(&quot;userInfo&quot;, JSON.stringify(userInfo))</span><br><span class="line">    &#125;,</span><br><span class="line">    REMOVE_INFO: (state) =&gt; &#123;</span><br><span class="line">      localStorage.setItem(&quot;token&quot;, &#x27;&#x27;)</span><br><span class="line">      sessionStorage.setItem(&quot;userInfo&quot;, JSON.stringify(&#x27;&#x27;))</span><br><span class="line">      state.userInfo = &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  getters: &#123;</span><br><span class="line">    getUser: state =&gt; &#123;</span><br><span class="line">      return state.userInfo</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;&#125;,</span><br><span class="line">  modules: &#123;&#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>存储token，我们用的是localStorage，存储用户信息，我们用的是sessionStorage。毕竟用户信息我们不需要长久保存，保存了token信息，我们随时都可以初始化用户信息。当然了因为本项目是个比较简单的项目，考虑到初学者，所以很多相对复杂的封装和功能我没有做，当然了，学了这个项目之后，自己想再继续深入，完成可以自行学习和改造哈。</p>
<h4 id="定义全局axios拦截器"><a href="#定义全局axios拦截器" class="headerlink" title="定义全局axios拦截器"></a>定义全局axios拦截器</h4><p>点击登录按钮发起登录请求，成功时候返回了数据，如果是密码错误，我们是不是也应该弹窗消息提示。为了让这个错误弹窗能运用到所有的地方，所以我对axios做了个后置拦截器，就是返回数据时候，如果结果的code或者status不正常，那么我对应弹窗提示。</p>
<p>在src目录下创建一个文件axios.js（与main.js同级），定义axios的拦截：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">import axios from &#x27;axios&#x27;</span><br><span class="line">import Element from &quot;element-ui&quot;;</span><br><span class="line">import store from &quot;./store&quot;;</span><br><span class="line">import router from &quot;./router&quot;;</span><br><span class="line">axios.defaults.baseURL=&#x27;http://localhost:8081&#x27;</span><br><span class="line">axios.interceptors.request.use(config =&gt; &#123;</span><br><span class="line">  console.log(&quot;前置拦截&quot;)</span><br><span class="line">  // 可以统一设置请求头</span><br><span class="line">  return config</span><br><span class="line">&#125;)</span><br><span class="line">axios.interceptors.response.use(response =&gt; &#123;</span><br><span class="line">    const res = response.data;</span><br><span class="line">    console.log(&quot;后置拦截&quot;)</span><br><span class="line">    // 当结果的code是否为200的情况</span><br><span class="line">    if (res.code === 200) &#123;</span><br><span class="line">      return response</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      // 弹窗异常信息</span><br><span class="line">      Element.Message(&#123;</span><br><span class="line">        message: response.data.msg,</span><br><span class="line">        type: &#x27;error&#x27;,</span><br><span class="line">        duration: 2 * 1000</span><br><span class="line">      &#125;)</span><br><span class="line">      // 直接拒绝往下面返回结果信息</span><br><span class="line">      return Promise.reject(response.data.msg)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  error =&gt; &#123;</span><br><span class="line">    console.log(&#x27;err&#x27; + error)// for debug</span><br><span class="line">    if(error.response.data) &#123;</span><br><span class="line">      error.message = error.response.data.msg</span><br><span class="line">    &#125;</span><br><span class="line">    // 根据请求状态觉得是否登录或者提示其他</span><br><span class="line">    if (error.response.status === 401) &#123;</span><br><span class="line">      store.commit(&#x27;REMOVE_INFO&#x27;);</span><br><span class="line">      router.push(&#123;</span><br><span class="line">        path: &#x27;/login&#x27;</span><br><span class="line">      &#125;);</span><br><span class="line">      error.message = &#x27;请重新登录&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">    if (error.response.status === 403) &#123;</span><br><span class="line">      error.message = &#x27;权限不足，无法访问&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">    Element.Message(&#123;</span><br><span class="line">      message: error.message,</span><br><span class="line">      type: &#x27;error&#x27;,</span><br><span class="line">      duration: 3 * 1000</span><br><span class="line">    &#125;)</span><br><span class="line">    return Promise.reject(error)</span><br><span class="line">  &#125;)</span><br></pre></td></tr></table></figure>

<p>前置拦截，其实可以统一为所有需要权限的请求装配上header的token信息，这样不需要在使用是再配置，我的小项目比较小，所以，还是免了吧~</p>
<p>然后再main.js中导入axios.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#x27;./axios.js&#x27; // 请求拦截</span><br></pre></td></tr></table></figure>

<p>后端因为返回的实体是Result，succ时候code为200，fail时候返回的是400，所以可以根据这里判断结果是否是正常的。另外权限不足时候可以通过请求结果的状态码来判断结果是否正常。这里都做了简单的处理。</p>
<p>登录异常时候的效果如下：</p>
<p><img src="https://image-1300566513.cos.ap-guangzhou.myqcloud.com/upload/images/20201117/84587fc9e3444debacf84ccc726f4058.png" alt="图片"></p>
<h3 id="9、博客列表"><a href="#9、博客列表" class="headerlink" title="9、博客列表"></a>9、博客列表</h3><p>登录完成之后直接进入博客列表页面，然后加载博客列表的数据渲染出来。同时页面头部我们需要把用户的信息展示出来，因为很多地方都用到这个模块，所以我们把页面头部的用户信息单独抽取出来作为一个组件。</p>
<h4 id="头部用户信息"><a href="#头部用户信息" class="headerlink" title="头部用户信息"></a>头部用户信息</h4><p>那么，我们先来完成头部的用户信息，应该包含三部分信息：id，头像、用户名，而这些信息我们是在登录之后就已经存在了sessionStorage。因此，我们可以通过store的getters获取到用户信息。</p>
<p><img src="https://image-1300566513.cos.ap-guangzhou.myqcloud.com/upload/images/20201117/6d33d6a010324a91a48537e975a4b1a0.png" alt="图片"></p>
<p>看起来不是很复杂，我们贴出代码：</p>
<ul>
<li>components\Header.vue</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;m-content&quot;&gt;</span><br><span class="line">    &lt;h3&gt;欢迎来到MarkerHub的博客&lt;/h3&gt;</span><br><span class="line">    &lt;div class=&quot;block&quot;&gt;</span><br><span class="line">      &lt;el-avatar :size=&quot;50&quot; :src=&quot;user.avatar&quot;&gt;&lt;/el-avatar&gt;</span><br><span class="line">      &lt;div&gt;&#123;&#123; user.username &#125;&#125;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div class=&quot;maction&quot;&gt;</span><br><span class="line">      &lt;el-link href=&quot;/blogs&quot;&gt;主页&lt;/el-link&gt;</span><br><span class="line">      &lt;el-divider direction=&quot;vertical&quot;&gt;&lt;/el-divider&gt;</span><br><span class="line">      &lt;span&gt;</span><br><span class="line">          &lt;el-link type=&quot;success&quot; href=&quot;/blog/add&quot; :disabled=&quot;!hasLogin&quot;&gt;发表文章&lt;/el-link&gt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">      &lt;el-divider direction=&quot;vertical&quot;&gt;&lt;/el-divider&gt;</span><br><span class="line">      &lt;span v-show=&quot;!hasLogin&quot;&gt;</span><br><span class="line">          &lt;el-link type=&quot;primary&quot; href=&quot;/login&quot;&gt;登陆&lt;/el-link&gt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">      &lt;span v-show=&quot;hasLogin&quot;&gt;</span><br><span class="line">          &lt;el-link type=&quot;danger&quot; @click=&quot;logout&quot;&gt;退出&lt;/el-link&gt;</span><br><span class="line">        &lt;/span&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">  export default &#123;</span><br><span class="line">    name: &quot;Header&quot;,</span><br><span class="line">    data() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        hasLogin: false,</span><br><span class="line">        user: &#123;</span><br><span class="line">          username: &#x27;请先登录&#x27;,</span><br><span class="line">          avatar: &quot;https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        blogs: &#123;&#125;,</span><br><span class="line">        currentPage: 1,</span><br><span class="line">        total: 0</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      logout() &#123;</span><br><span class="line">        const _this = this</span><br><span class="line">        this.$axios.get(&#x27;http://localhost:8081/logout&#x27;, &#123;</span><br><span class="line">          headers: &#123;</span><br><span class="line">            &quot;Authorization&quot;: localStorage.getItem(&quot;token&quot;)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;).then((res) =&gt; &#123;</span><br><span class="line">          _this.$store.commit(&#x27;REMOVE_INFO&#x27;)</span><br><span class="line">          _this.$router.push(&#x27;/login&#x27;)</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    created() &#123;</span><br><span class="line">      if(this.$store.getters.getUser.username) &#123;</span><br><span class="line">        this.user.username = this.$store.getters.getUser.username</span><br><span class="line">        this.user.avatar = this.$store.getters.getUser.avatar</span><br><span class="line">        this.hasLogin = true</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>上面代码created()中初始化用户的信息，通过hasLogin的状态来控制登录和退出按钮的切换，以及发表文章链接的disabled，这样用户的信息就能展示出来了。<br>然后这里有个退出按钮，在methods中有个logout()方法，逻辑比较简单，直接访问&#x2F;logout，因为之前axios.js中我们已经设置axios请求的baseURL，所以这里我们不再需要链接的前缀了哈。因为是登录之后才能访问的受限资源，所以在header中带上了Authorization。返回结果清楚store中的用户信息和token信息，跳转到登录页面。</p>
<p>然后需要头部用户信息的页面只需要几个步骤：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import Header from &quot;@/components/Header&quot;;</span><br><span class="line">data() &#123;</span><br><span class="line">  components: &#123;Header&#125;</span><br><span class="line">&#125;</span><br><span class="line"># 然后模板中调用组件</span><br><span class="line">&lt;Header&gt;&lt;/Header&gt;</span><br></pre></td></tr></table></figure>

<h4 id="博客分页"><a href="#博客分页" class="headerlink" title="博客分页"></a>博客分页</h4><p>接下来就是列表页面，需要做分页，列表我们在element-ui中直接使用<strong>时间线</strong>组件来作为我们的列表样式，还是挺好看的。还有我们的分页组件。</p>
<p>需要几部分信息：</p>
<ul>
<li>分页信息</li>
<li>博客列表内容，包括id、标题、摘要、创建时间</li>
<li>views\Blogs.vue</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;m-container&quot;&gt;</span><br><span class="line">    &lt;Header&gt;&lt;/Header&gt;</span><br><span class="line">    &lt;div class=&quot;block&quot;&gt;</span><br><span class="line">      &lt;el-timeline&gt;</span><br><span class="line">        &lt;el-timeline-item v-bind:timestamp=&quot;blog.created&quot; placement=&quot;top&quot; v-for=&quot;blog in blogs&quot;&gt;</span><br><span class="line">          &lt;el-card&gt;</span><br><span class="line">            &lt;h4&gt;&lt;router-link :to=&quot;&#123;name: &#x27;BlogDetail&#x27;, params: &#123;blogId: blog.id&#125;&#125;&quot;&gt;&#123;&#123;blog.title&#125;&#125;&lt;/router-link&gt;&lt;/h4&gt;</span><br><span class="line">            &lt;p&gt;&#123;&#123;blog.description&#125;&#125;&lt;/p&gt;</span><br><span class="line">          &lt;/el-card&gt;</span><br><span class="line">        &lt;/el-timeline-item&gt;</span><br><span class="line">      &lt;/el-timeline&gt;</span><br><span class="line"></span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;el-pagination class=&quot;mpage&quot;</span><br><span class="line">      background</span><br><span class="line">      layout=&quot;prev, pager, next&quot;</span><br><span class="line">      :current-page=currentPage</span><br><span class="line">      :page-size=pageSize</span><br><span class="line">      @current-change=page</span><br><span class="line">      :total=&quot;total&quot;&gt;</span><br><span class="line">    &lt;/el-pagination&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">  import Header from &quot;@/components/Header&quot;;</span><br><span class="line">  export default &#123;</span><br><span class="line">    name: &quot;Blogs&quot;,</span><br><span class="line">    components: &#123;Header&#125;,</span><br><span class="line">    data() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        blogs: &#123;&#125;,</span><br><span class="line">        currentPage: 1,</span><br><span class="line">        total: 0,</span><br><span class="line">        pageSize: 5</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      page(currentPage) &#123;</span><br><span class="line">        const _this = this</span><br><span class="line">        this.$axios.get(&#x27;http://localhost:8081/blogs?currentPage=&#x27; + currentPage).then((res) =&gt; &#123;</span><br><span class="line">          console.log(res.data.data.records)</span><br><span class="line">          _this.blogs = res.data.data.records</span><br><span class="line">          _this.currentPage = res.data.data.current</span><br><span class="line">          _this.total = res.data.data.total</span><br><span class="line">          _this.pageSize = res.data.data.size</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    mounted () &#123;</span><br><span class="line">      this.page(1);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>data()中直接定义博客列表blogs、以及一些分页信息。methods()中定义分页的调用接口page（currentPage），参数是需要调整的页码currentPage，得到结果之后直接赋值即可。然后初始化时候，直接在mounted()方法中调用第一页this.page(1)。完美。使用element-ui组件就是简单快捷哈哈！<br>注意标题这里我们添加了链接，使用的是<router-link>标签。</p>
<h3 id="10、博客编辑（发表）"><a href="#10、博客编辑（发表）" class="headerlink" title="10、博客编辑（发表）"></a>10、博客编辑（发表）</h3><p>我们点击发表博客链接调整到&#x2F;blog&#x2F;add页面，这里我们需要用到一个markdown编辑器，在vue组件中，比较好用的是mavon-editor，那么我们直接使用哈。先来安装mavon-editor相关组件：</p>
<h4 id="安装mavon-editor"><a href="#安装mavon-editor" class="headerlink" title="安装mavon-editor"></a>安装mavon-editor</h4><p>基于Vue的markdown编辑器mavon-editor</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install mavon-editor --save</span><br></pre></td></tr></table></figure>

<p>然后在main.js中全局注册：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 全局注册</span></span><br><span class="line"><span class="keyword">import</span> <span class="title class_">Vue</span> <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> mavonEditor <span class="keyword">from</span> <span class="string">&#x27;mavon-editor&#x27;</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&#x27;mavon-editor/dist/css/index.css&#x27;</span></span><br><span class="line"><span class="comment">// use</span></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">use</span>(mavonEditor)</span><br></pre></td></tr></table></figure>

<p>ok，那么我们去定义我们的博客表单：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;m-container&quot;&gt;</span><br><span class="line">    &lt;Header&gt;&lt;/Header&gt;</span><br><span class="line">    &lt;div class=&quot;m-content&quot;&gt;</span><br><span class="line">      &lt;el-form ref=&quot;editForm&quot; status-icon :model=&quot;editForm&quot; :rules=&quot;rules&quot; label-width=&quot;80px&quot;&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;标题&quot; prop=&quot;title&quot;&gt;</span><br><span class="line">          &lt;el-input v-model=&quot;editForm.title&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;摘要&quot; prop=&quot;description&quot;&gt;</span><br><span class="line">          &lt;el-input type=&quot;textarea&quot; v-model=&quot;editForm.description&quot;&gt;&lt;/el-input&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item label=&quot;内容&quot; prop=&quot;content&quot;&gt;</span><br><span class="line">          &lt;mavon-editor v-model=&quot;editForm.content&quot;/&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">        &lt;el-form-item&gt;</span><br><span class="line">          &lt;el-button type=&quot;primary&quot; @click=&quot;submitForm()&quot;&gt;立即创建&lt;/el-button&gt;</span><br><span class="line">          &lt;el-button&gt;取消&lt;/el-button&gt;</span><br><span class="line">        &lt;/el-form-item&gt;</span><br><span class="line">      &lt;/el-form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">  import Header from &quot;@/components/Header&quot;;</span><br><span class="line">  export default &#123;</span><br><span class="line">    name: &quot;BlogEdit&quot;,</span><br><span class="line">    components: &#123;Header&#125;,</span><br><span class="line">    data() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        editForm: &#123;</span><br><span class="line">          id: null,</span><br><span class="line">          title: &#x27;&#x27;,</span><br><span class="line">          description: &#x27;&#x27;,</span><br><span class="line">          content: &#x27;&#x27;</span><br><span class="line">        &#125;,</span><br><span class="line">        rules: &#123;</span><br><span class="line">          title: [</span><br><span class="line">            &#123;required: true, message: &#x27;请输入标题&#x27;, trigger: &#x27;blur&#x27;&#125;,</span><br><span class="line">            &#123;min: 3, max: 50, message: &#x27;长度在 3 到 50 个字符&#x27;, trigger: &#x27;blur&#x27;&#125;</span><br><span class="line">          ],</span><br><span class="line">          description: [</span><br><span class="line">            &#123;required: true, message: &#x27;请输入摘要&#x27;, trigger: &#x27;blur&#x27;&#125;</span><br><span class="line">          ]</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    created() &#123;</span><br><span class="line">      const blogId = this.$route.params.blogId</span><br><span class="line">      const _this = this</span><br><span class="line">      if(blogId) &#123;</span><br><span class="line">        this.$axios.get(&#x27;/blog/&#x27; + blogId).then((res) =&gt; &#123;</span><br><span class="line">          const blog = res.data.data</span><br><span class="line">          _this.editForm.id = blog.id</span><br><span class="line">          _this.editForm.title = blog.title</span><br><span class="line">          _this.editForm.description = blog.description</span><br><span class="line">          _this.editForm.content = blog.content</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      submitForm() &#123;</span><br><span class="line">        const _this = this</span><br><span class="line">        this.$refs.editForm.validate((valid) =&gt; &#123;</span><br><span class="line">          if (valid) &#123;</span><br><span class="line">            this.$axios.post(&#x27;/blog/edit&#x27;, this.editForm, &#123;</span><br><span class="line">              headers: &#123;</span><br><span class="line">                &quot;Authorization&quot;: localStorage.getItem(&quot;token&quot;)</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;).then((res) =&gt; &#123;</span><br><span class="line">              _this.$alert(&#x27;操作成功&#x27;, &#x27;提示&#x27;, &#123;</span><br><span class="line">                confirmButtonText: &#x27;确定&#x27;,</span><br><span class="line">                callback: action =&gt; &#123;</span><br><span class="line">                  _this.$router.push(&quot;/blogs&quot;)</span><br><span class="line">                &#125;</span><br><span class="line">              &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">          &#125; else &#123;</span><br><span class="line">            console.log(&#x27;error submit!!&#x27;);</span><br><span class="line">            return false;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>逻辑依然简单，校验表单，然后点击按钮提交表单，注意头部加上Authorization信息，返回结果弹窗提示操作成功，然后跳转到博客列表页面。emm，和写ajax没啥区别。熟悉一下vue的一些指令使用即可。<br>然后因为编辑和添加是同一个页面，所以有了create()方法，比如从编辑连接&#x2F;blog&#x2F;7&#x2F;edit中获取blogId为7的这个id。然后回显博客信息。获取方式是const blogId &#x3D; this.$route.params.blogId。</p>
<p>对了，mavon-editor因为已经全局注册，所以我们直接使用组件即可：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;mavon-editor v-model=&quot;editForm.content&quot;/&gt;</span><br></pre></td></tr></table></figure>

<p>效果如下：<br><img src="https://image-1300566513.cos.ap-guangzhou.myqcloud.com/upload/images/20201117/61c514b1b68c4cf1b07a87b51eacd8bf.png" alt="图片"></p>
<h3 id="11、博客详情"><a href="#11、博客详情" class="headerlink" title="11、博客详情"></a>11、博客详情</h3><p>博客详情中需要回显博客信息，然后有个问题就是，后端传过来的是博客内容是markdown格式的内容，我们需要进行渲染然后显示出来，这里我们使用一个插件markdown-it，用于解析md文档，然后导入github-markdown-c，所谓md的样式。</p>
<p>方法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 用于解析md文档</span><br><span class="line">cnpm install markdown-it --save</span><br><span class="line"># md样式</span><br><span class="line">cnpm install github-markdown-css</span><br></pre></td></tr></table></figure>

<p>然后就可以在需要渲染的地方使用：</p>
<ul>
<li>views\BlogDetail.vue</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div class=&quot;m-container&quot;&gt;</span><br><span class="line">    &lt;Header&gt;&lt;/Header&gt;</span><br><span class="line">    &lt;div class=&quot;mblog&quot;&gt;</span><br><span class="line">      &lt;h2&gt;&#123;&#123; blog.title &#125;&#125;&lt;/h2&gt;</span><br><span class="line">      &lt;el-link icon=&quot;el-icon-edit&quot; v-if=&quot;ownBlog&quot;&gt;&lt;router-link :to=&quot;&#123;name: &#x27;BlogEdit&#x27;, params: &#123;blogId: blog.id&#125;&#125;&quot;&gt;编辑&lt;/router-link&gt;&lt;/el-link&gt;</span><br><span class="line">      &lt;el-divider&gt;&lt;/el-divider&gt;</span><br><span class="line">      &lt;div class=&quot;content markdown-body&quot; v-html=&quot;blog.content&quot;&gt;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">  import &#x27;github-markdown-css/github-markdown.css&#x27; // 然后添加样式markdown-body</span><br><span class="line">  import Header from &quot;@/components/Header&quot;;</span><br><span class="line">  export default &#123;</span><br><span class="line">    name: &quot;BlogDetail&quot;,</span><br><span class="line">    components: &#123;</span><br><span class="line">      Header</span><br><span class="line">    &#125;,</span><br><span class="line">    data() &#123;</span><br><span class="line">      return &#123;</span><br><span class="line">        blog: &#123;</span><br><span class="line">          userId: null,</span><br><span class="line">          title: &quot;&quot;,</span><br><span class="line">          description: &quot;&quot;,</span><br><span class="line">          content: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        ownBlog: false</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">      getBlog() &#123;</span><br><span class="line">        const blogId = this.$route.params.blogId</span><br><span class="line">        const _this = this</span><br><span class="line">        this.$axios.get(&#x27;/blog/&#x27; + blogId).then((res) =&gt; &#123;</span><br><span class="line">          console.log(res)</span><br><span class="line">          console.log(res.data.data)</span><br><span class="line">          _this.blog = res.data.data</span><br><span class="line">          var MarkdownIt = require(&#x27;markdown-it&#x27;),</span><br><span class="line">            md = new MarkdownIt();</span><br><span class="line">          var result = md.render(_this.blog.content);</span><br><span class="line">          _this.blog.content = result</span><br><span class="line">          // 判断是否是自己的文章，能否编辑</span><br><span class="line">          _this.ownBlog =  (_this.blog.userId === _this.$store.getters.getUser.id)</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    created() &#123;</span><br><span class="line">      this.getBlog()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>具体逻辑还是挺简单，初始化create()方法中调用getBlog()方法，请求博客详情接口，返回的博客详情content通过markdown-it工具进行渲染。</p>
<p>再导入样式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#x27;github-markdown.css&#x27;</span><br></pre></td></tr></table></figure>

<p>然后在content的div中添加class为markdown-body即可哈。<br>效果如下：</p>
<p><img src="https://image-1300566513.cos.ap-guangzhou.myqcloud.com/upload/images/20201117/7244e11b1cbe456daf043f815b9877f8.png" alt="图片"></p>
<p>另外标题下添加了个小小的编辑按钮，通过ownBlog （判断博文作者与登录用户是否同一人）来判断按钮是否显示出来。</p>
<h3 id="12、路由权限拦截"><a href="#12、路由权限拦截" class="headerlink" title="12、路由权限拦截"></a>12、路由权限拦截</h3><p>页面已经开发完毕之后，我们来控制一下哪些页面是需要登录之后才能跳转的，如果未登录访问就直接重定向到登录页面，因此我们在src目录下定义一个js文件：</p>
<ul>
<li>src\permission.js</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import router from &quot;./router&quot;;</span><br><span class="line">// 路由判断登录 根据路由配置文件的参数</span><br><span class="line">router.beforeEach((to, from, next) =&gt; &#123;</span><br><span class="line">  if (to.matched.some(record =&gt; record.meta.requireAuth)) &#123; // 判断该路由是否需要登录权限</span><br><span class="line">    const token = localStorage.getItem(&quot;token&quot;)</span><br><span class="line">    console.log(&quot;------------&quot; + token)</span><br><span class="line">    if (token) &#123; // 判断当前的token是否存在 ； 登录存入的token</span><br><span class="line">      if (to.path === &#x27;/login&#x27;) &#123;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        next()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      next(&#123;</span><br><span class="line">        path: &#x27;/login&#x27;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; else &#123;</span><br><span class="line">    next()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>通过之前我们再定义页面路由时候的的meta信息，指定requireAuth: true，需要登录才能访问，因此这里我们在每次路由之前（router.beforeEach）判断token的状态，觉得是否需要跳转到登录页面。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  path: &#x27;/blog/add&#x27;, // 注意放在 path: &#x27;/blog/:blogId&#x27;之前</span><br><span class="line">  name: &#x27;BlogAdd&#x27;,</span><br><span class="line">  meta: &#123;</span><br><span class="line">    requireAuth: true</span><br><span class="line">  &#125;,</span><br><span class="line">  component: BlogEdit</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后我们再main.js中import我们的permission.js</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import &#x27;./permission.js&#x27; // 路由拦截</span><br></pre></td></tr></table></figure>

<h3 id="13、前端总结"><a href="#13、前端总结" class="headerlink" title="13、前端总结"></a>13、前端总结</h3><p>ok，基本所有页面就已经开发完毕啦，css样式信息我未贴出来，大家直接上github上clone下来查看。</p>
<h2 id="项目大总结"><a href="#项目大总结" class="headerlink" title="项目大总结"></a>项目大总结</h2><p>好啦，项目先到这里，花了3天半录制了一套对应的视频，记得去看，给我三连哇。</p>
<p>项目代码：<a target="_blank" rel="noopener" href="https://github.com/MarkerHub/vueblog">https://github.com/MarkerHub/vueblog</a></p>
<p>项目视频：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1PQ4y1P7hZ/">https://www.bilibili.com/video/BV1PQ4y1P7hZ/</a></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">jpruby</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://jpruby888.github.io/post/3eb4351b.html">https://jpruby888.github.io/post/3eb4351b.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://jpruby888.github.io" target="_blank">jpruby的blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/java/">java</a><a class="post-meta__tags" href="/tags/vue/">vue</a></div><div class="post_share"><div class="social-share" data-image="/images/featureimages/13.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.png" target="_blank"><img class="post-qr-code-img" src="/img/wechat.png" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/post/8c301d70.html"><img class="prev-cover" src="/images/featureimages/12.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">困了早点睡吧，找个博客也就我一个人在叽歪</div></div></a></div><div class="next-post pull-right"><a href="/post/a9c4edf1.html"><img class="next-cover" src="/images/featureimages/5.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">反射工具包JOOR、Hutool与原生反射对比</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/images/favicon.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">jpruby</div><div class="author-info__description">宁静致远</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">248</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">222</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">33</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://gitee.com/jpruby"><i class="fab fa-github"></i><span>追随我吧</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">一个放笔记的地方，如果你喜欢请评论</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB%E9%A1%B9%E7%9B%AE"><span class="toc-number">1.</span> <span class="toc-text">前后端分离项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Java%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91"><span class="toc-number">2.</span> <span class="toc-text">Java后端接口开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%89%8D%E8%A8%80"><span class="toc-number">2.1.</span> <span class="toc-text">1、前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%96%B0%E5%BB%BASpringboot%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.2.</span> <span class="toc-text">2、新建Springboot项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E6%95%B4%E5%90%88mybatis-plus"><span class="toc-number">2.3.</span> <span class="toc-text">3、整合mybatis plus</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E7%BB%9F%E4%B8%80%E7%BB%93%E6%9E%9C%E5%B0%81%E8%A3%85"><span class="toc-number">2.4.</span> <span class="toc-text">3、统一结果封装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E6%95%B4%E5%90%88shiro-jwt%EF%BC%8C%E5%B9%B6%E4%BC%9A%E8%AF%9D%E5%85%B1%E4%BA%AB"><span class="toc-number">2.5.</span> <span class="toc-text">4、整合shiro+jwt，并会话共享</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ShiroConfig"><span class="toc-number">2.5.1.</span> <span class="toc-text">ShiroConfig</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AccountRealm"><span class="toc-number">2.5.2.</span> <span class="toc-text">AccountRealm</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JwtToken"><span class="toc-number">2.5.3.</span> <span class="toc-text">JwtToken</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AccountProfile"><span class="toc-number">2.5.4.</span> <span class="toc-text">AccountProfile</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JwtFilter"><span class="toc-number">2.5.5.</span> <span class="toc-text">JwtFilter</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86"><span class="toc-number">2.6.</span> <span class="toc-text">5、异常处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E5%AE%9E%E4%BD%93%E6%A0%A1%E9%AA%8C"><span class="toc-number">2.7.</span> <span class="toc-text">6、实体校验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81%E8%B7%A8%E5%9F%9F%E9%97%AE%E9%A2%98"><span class="toc-number">2.8.</span> <span class="toc-text">7、跨域问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%E3%80%81%E7%99%BB%E5%BD%95%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91"><span class="toc-number">2.9.</span> <span class="toc-text">8、登录接口开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%E3%80%81%E5%8D%9A%E5%AE%A2%E6%8E%A5%E5%8F%A3%E5%BC%80%E5%8F%91"><span class="toc-number">2.10.</span> <span class="toc-text">9、博客接口开发</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10%E3%80%81%E5%90%8E%E7%AB%AF%E6%80%BB%E7%BB%93"><span class="toc-number">2.11.</span> <span class="toc-text">10、后端总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Vue%E5%89%8D%E7%AB%AF%E9%A1%B5%E9%9D%A2%E5%BC%80%E5%8F%91"><span class="toc-number">3.</span> <span class="toc-text">Vue前端页面开发</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%89%8D%E8%A8%80-1"><span class="toc-number">3.1.</span> <span class="toc-text">1、前言</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E9%A1%B9%E7%9B%AE%E6%BC%94%E7%A4%BA"><span class="toc-number">3.2.</span> <span class="toc-text">2、项目演示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">3.3.</span> <span class="toc-text">3、环境准备</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E6%96%B0%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-number">3.4.</span> <span class="toc-text">4、新建项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E5%AE%89%E8%A3%85element-ui"><span class="toc-number">3.5.</span> <span class="toc-text">5、安装element-ui</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E5%AE%89%E8%A3%85axios"><span class="toc-number">3.6.</span> <span class="toc-text">6、安装axios</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81%E9%A1%B5%E9%9D%A2%E8%B7%AF%E7%94%B1"><span class="toc-number">3.7.</span> <span class="toc-text">7、页面路由</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%E3%80%81%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2"><span class="toc-number">3.8.</span> <span class="toc-text">8、登录页面</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#token%E7%9A%84%E7%8A%B6%E6%80%81%E5%90%8C%E6%AD%A5"><span class="toc-number">3.8.1.</span> <span class="toc-text">token的状态同步</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89%E5%85%A8%E5%B1%80axios%E6%8B%A6%E6%88%AA%E5%99%A8"><span class="toc-number">3.8.2.</span> <span class="toc-text">定义全局axios拦截器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%E3%80%81%E5%8D%9A%E5%AE%A2%E5%88%97%E8%A1%A8"><span class="toc-number">3.9.</span> <span class="toc-text">9、博客列表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%B4%E9%83%A8%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF"><span class="toc-number">3.9.1.</span> <span class="toc-text">头部用户信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8D%9A%E5%AE%A2%E5%88%86%E9%A1%B5"><span class="toc-number">3.9.2.</span> <span class="toc-text">博客分页</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10%E3%80%81%E5%8D%9A%E5%AE%A2%E7%BC%96%E8%BE%91%EF%BC%88%E5%8F%91%E8%A1%A8%EF%BC%89"><span class="toc-number">3.10.</span> <span class="toc-text">10、博客编辑（发表）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%89%E8%A3%85mavon-editor"><span class="toc-number">3.10.1.</span> <span class="toc-text">安装mavon-editor</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11%E3%80%81%E5%8D%9A%E5%AE%A2%E8%AF%A6%E6%83%85"><span class="toc-number">3.11.</span> <span class="toc-text">11、博客详情</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12%E3%80%81%E8%B7%AF%E7%94%B1%E6%9D%83%E9%99%90%E6%8B%A6%E6%88%AA"><span class="toc-number">3.12.</span> <span class="toc-text">12、路由权限拦截</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#13%E3%80%81%E5%89%8D%E7%AB%AF%E6%80%BB%E7%BB%93"><span class="toc-number">3.13.</span> <span class="toc-text">13、前端总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%B9%E7%9B%AE%E5%A4%A7%E6%80%BB%E7%BB%93"><span class="toc-number">4.</span> <span class="toc-text">项目大总结</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/8c301d70.html" title="困了早点睡吧，找个博客也就我一个人在叽歪">困了早点睡吧，找个博客也就我一个人在叽歪</a><time datetime="2022-03-22T14:27:50.000Z" title="发表于 2022-03-22 22:27:50">2022-03-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/3eb4351b.html" title="前后端分离项目笔记">前后端分离项目笔记</a><time datetime="2022-03-20T14:24:12.000Z" title="发表于 2022-03-20 22:24:12">2022-03-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/a9c4edf1.html" title="反射工具包JOOR、Hutool与原生反射对比">反射工具包JOOR、Hutool与原生反射对比</a><time datetime="2021-08-16T02:34:45.000Z" title="发表于 2021-08-16 10:34:45">2021-08-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/d232be0e.html" title="使用CODEX为你的项目编制一套代码库目录/索引">使用CODEX为你的项目编制一套代码库目录/索引</a><time datetime="2021-08-16T02:33:53.000Z" title="发表于 2021-08-16 10:33:53">2021-08-16</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/9e3b75c0.html" title="screw 一颗螺丝钉的使命">screw 一颗螺丝钉的使命</a><time datetime="2021-08-16T02:32:21.000Z" title="发表于 2021-08-16 10:32:21">2021-08-16</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2022 By jpruby</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">一看就会，一写就废？反复,重复,反反复复就能成功。<a target="_blank" rel="noopener" href="https://gitee.com/jpruby">My Gitee</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '5g1AnWHsYMWblJhcTd3L809a-gzGzoHsz',
      appKey: '1G1h3tESCEAaSk1sBraitwqN',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>